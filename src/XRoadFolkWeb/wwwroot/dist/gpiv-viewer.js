(function(){"use strict";function u(t,e){try{if(!e)return;window&&window.console&&console.debug&&console.debug(t,e)}catch{}}function Y(t){try{if(!t)return"";let e=atob(t);if(!/[\x80-\xFF]/.test(e))return e;let n=Uint8Array.from(e,o=>o.charCodeAt(0));return new TextDecoder("utf-8",{fatal:!1}).decode(n)}catch(e){return u("gpiv:b64ToUtf8",e),""}}let B=typeof window<"u"&&window.gpivHelpers?window.gpivHelpers:{},it=B.iconClassFor||function(){return"bi-list-ul"},Nt=B.prettify||(t=>String(t||"")),ct=B.nextUid||(t=>(t||"id")+"-"+Date.now()),O=B.clearChildren||function(t){try{for(;t&&t.firstChild;)t.removeChild(t.firstChild)}catch(e){u("gpiv:clearChildren",e)}},rt=B.handleAccordionKeydown||function(){},H=B.copyToClipboard||async function(){return!1},X=B.downloadBlob||function(){},lt=B.toggleFullscreenWithCssFallback||function(t,e){t&&t.classList&&t.classList.toggle(e)},st=B.focusFirstAccordionButton||function(t){try{let e=(t||document).querySelector(".accordion .accordion-header .accordion-button");e&&e.focus&&e.focus()}catch(e){u("gpiv:focusFirstAccordionButton",e)}},at=B.toggleAllAccordions||function(t,e){try{let n=(t||document).querySelectorAll(".accordion-collapse")||[];for(let i=0;i<n.length;i++){let s=n[i];s&&s.classList.toggle("show",!!e)}let o=(t||document).querySelectorAll(".accordion-button")||[];for(let i=0;i<o.length;i++){let s=o[i];s&&(s.classList.toggle("collapsed",!e),s.setAttribute("aria-expanded",e?"true":"false"))}}catch(n){u("gpiv:toggleAllAccordions",n)}};function w(t){return document.getElementById(t)}function dt(t,e){return(e||document).querySelector(t)}function ut(t,e){return(e||document).querySelectorAll(t)}function k(t,e,n){let o=document.createElement(t);return e&&(o.className=e),n!=null&&(o.textContent=n),o}let x=null,q=null,E=null,f={},D="",I="";function pt(t){let n=new DOMParser().parseFromString(t,"application/xml"),o=n.querySelector("parsererror");if(o)throw new Error(o.textContent||"Invalid XML");return n}function $(){try{let t=w("people-search-card");if(!t||!E)return;if(E.classList.contains("gpiv-fullscreen")){E.style.height="";return}let e=Math.round(t.getBoundingClientRect().height);e>0&&(E.style.height=e+"px")}catch(t){console.error("gpiv: syncViewerHeight failed",t)}}let j=0,ft=75;function S(){try{j&&clearTimeout(j)}catch(t){u("gpiv:scheduleHeightSync-clearTimeout",t)}j=setTimeout(function(){j=0;try{(window.requestAnimationFrame||function(t){return setTimeout(t,16)})(function(){$()})}catch(t){u("gpiv:scheduleHeightSync-rAF",t),$()}},ft)}function mt(t,e){t.textContent="";let n=document.createElement("i");n.className="bi "+it(e)+" me-2",n.setAttribute("aria-hidden","true"),t.appendChild(n),t.appendChild(document.createTextNode(e||""))}function M(t){if(!t||t.nodeType!==1||!t.attributes)return!1;for(let e=0;e<t.attributes.length;e++){let n=t.attributes[e];if((n.localName||n.name)==="nil"&&/^(true|1)$/i.test((n.value||"").trim()))return!0}return!1}function Q(t){if(!t||!t.children)return!1;for(let e=0;e<t.children.length;e++)if(!M(t.children[e]))return!0;return!1}function U(t){if(!t)return!1;let e=String(t).toLowerCase();return e==="id"||e==="personaddressid"}let Z="@";function V(t){let e=[];if(t&&t.attributes&&t.attributes.length)for(let l=0;l<t.attributes.length;l++){let r=t.attributes[l],c=r.localName||r.name||"";U(c)||e.push({key:Z+(r.name||""),val:r.value||""})}let n=t&&t.children?t.children:[];for(let l=0;l<n.length;l++){let r=n[l],c=M(r);if(c||!Q(r)){if(U(r.localName))continue;let y=c?"":(r.textContent||"").trim();if(e.push({key:r.localName,val:y}),!c&&r.attributes&&r.attributes.length)for(let N=0;N<r.attributes.length;N++){let v=r.attributes[N],T=v.localName||v.name||"";U(T)||e.push({key:r.localName+" "+Z+(v.name||""),val:v.value||""})}}}if(!e.length)return null;let o=document.createElement("div");o.className="table-responsive";let i=document.createElement("table");i.className="table table-sm table-striped align-middle mb-0";let s=document.createElement("tbody");for(let l=0;l<e.length;l++){let r=document.createElement("tr"),c=document.createElement("th");c.className="text-muted fw-normal",c.style.width="36%",c.textContent=e[l].key;let b=document.createElement("td");b.textContent=e[l].val,r.appendChild(c),r.appendChild(b),s.appendChild(r)}return i.appendChild(s),o.appendChild(i),o}function F(t,e){if(!t||!t.children)return"";for(let n=0;n<t.children.length;n++){let o=t.children[n];if(o.localName===e)return(o.textContent||"").trim()}return""}function ht(t){let e=document.createElement("span");return e.className="badge text-bg-light",e.textContent=t,e}function z(t,e,n,o){let i=document.createElement("div");i.className="accordion-item";let s=t+"-h-"+e,l=t+"-c-"+e,r=document.createElement("h2");r.className="accordion-header",r.id=s;let c=document.createElement("button");c.type="button",c.className="accordion-button"+(o?"":" collapsed"),c.setAttribute("data-bs-toggle","collapse"),c.setAttribute("data-bs-target","#"+l),c.setAttribute("aria-expanded",o?"true":"false"),c.setAttribute("aria-controls",l),mt(c,n||""),r.appendChild(c);let b=document.createElement("div");b.id=l,b.className="accordion-collapse collapse"+(o?" show":""),b.setAttribute("aria-labelledby",s);let y=document.createElement("div");return y.className="accordion-body p-0",y.dataset.rendered="0",b.appendChild(y),i.appendChild(r),i.appendChild(b),{item:i,body:y}}function tt(t){x&&at(x,t)}function et(t){let e=Object.create(null);if(!t||!t.children)return e;for(let n=0;n<t.children.length;n++){let o=t.children[n];if(!o||o.nodeType!==1||o.localName==="Names"||M(o)||!Q(o))continue;let i=o.localName;(e[i]||(e[i]=[])).push(o)}return e}function gt(t){let e=[],n=t.getElementsByTagName("*");for(let o=0;o<n.length;o++)n[o].localName==="PersonPublicInfo"&&e.push(n[o]);if(e.length>0)return e;for(let o=0;o<n.length;o++)n[o].localName==="Person"&&e.push(n[o]);if(e.length>0,e)return e;for(let o=0;o<n.length;o++){let i=n[o],s=i.localName;if(!i.children||s==="Names"||s==="Name"||s==="ListOfPersonPublicInfo"||s==="ListOfPersonPublicInfoCriteria")continue;let l=!1,r=!1;for(let c=0;c<i.children.length;c++){let y=i.children[c].localName;(y==="PublicId"||y==="PersonId")&&(l=!0),y==="Names"&&(r=!0)}(l||r)&&e.push(i)}return e}function bt(t){let e=document.createElement("div");e.className="btn-group btn-group-sm align-self-center ms-2";function n(s){if(!t)return;let l=t.getAttribute("data-mode")||"";if(!t.classList.contains("d-none")&&l===s){t.classList.add("d-none");return}t.setAttribute("data-mode",s),t.classList.remove("d-none"),O(t);let c=s==="raw"?I||"":D||I||"",b=document.createElement("div");b.className="p-2 border rounded bg-body-tertiary";let y=document.createElement("div");y.className="d-flex justify-content-end gap-2 mb-2";let N=document.createElement("button");N.type="button",N.className="btn btn-sm btn-outline-secondary",N.textContent=f.Copy||"Copy",N.addEventListener("click",function(){H(c).then(function(){let P=N.textContent;N.textContent=f.Copied||"Copied",setTimeout(function(){N.textContent=P},1200)}).catch(function(P){u("gpiv:copy-inline",P)})});let v=document.createElement("button");v.type="button",v.className="btn btn-sm btn-outline-secondary",v.textContent=f.Download||"Download",v.addEventListener("click",function(){try{let P=new Date().toISOString().replace(/[:.]/g,"-"),L=(s==="raw"?"GetPeoplePublicInfo_raw_":"GetPeoplePublicInfo_pretty_")+P+".xml";X(L,c,"text/xml;charset=utf-8")}catch(P){u("gpiv:download-inline",P)}}),y.appendChild(N),y.appendChild(v);let T=document.createElement("pre");T.className="gpiv-pre mb-0",T.style.maxHeight="16rem",T.style.overflow="auto",T.textContent=c,b.appendChild(y),b.appendChild(T),t.appendChild(b)}let o=document.createElement("button");o.type="button",o.className="btn btn-outline-secondary",o.innerHTML='<i class="bi bi-filetype-xml me-1" aria-hidden="true"></i>'+(f.RawXml||"Raw XML"),o.addEventListener("click",function(){n("raw")}),e.appendChild(o);let i=document.createElement("button");return i.type="button",i.className="btn btn-outline-secondary",i.innerHTML='<i class="bi bi-braces-asterisk me-1" aria-hidden="true"></i>'+(f.PrettyXml||"Pretty XML"),i.addEventListener("click",function(){n("pretty")}),e.appendChild(i),e}function _(t){let e=document.createElement("div");e.className="d-flex flex-column gap-2";let n=V(t);n&&e.appendChild(n);let o=et(t);for(let i in o){if(!Object.prototype.hasOwnProperty.call(o,i))continue;let s=o[i];if(s.length>1){let l=document.createElement("div");l.className="d-flex flex-column gap-2";for(let r=0;r<s.length;r++){let c=k("div","p-2 border rounded",null),b=k("div","small text-muted mb-1",i+" #"+(r+1));c.appendChild(b);let y=_(s[r]);y&&c.appendChild(y),l.appendChild(c)}e.appendChild(l)}else{let l=_(s[0]),r=k("div","small text-muted mb-1",i),c=document.createElement("div");c.className="p-2 border rounded",c.appendChild(r),l&&c.appendChild(l),e.appendChild(c)}}return e}function yt(){O(x);try{let t=I&&I.trim()?I:D||"";if(!t.trim()){x.textContent=f.NoXmlToDisplay||"No XML to display.",S();return}let e=pt(t),n=gt(e);if(!n||n.length===0){x.appendChild(k("div","text-muted",f.NoPeopleFound||"No people found.")),S();return}let o=document.createDocumentFragment();for(let i=0;i<n.length;i++){let s=n[i],l=document.createElement("div");l.className="mb-3 p-2 border rounded gpiv-person",l.setAttribute("data-idx",String(i));let r=k("div","gpiv-person-header d-flex flex-wrap gap-2 align-items-baseline mb-2",null);r.appendChild(k("span","badge text-bg-secondary","#"+(i+1)));let c=null;for(let a=0;a<s.children.length;a++)if(s.children[a].localName==="Names"){c=s.children[a];break}let b="";if(c){let a=[],m="";for(let h=0;h<c.children.length;h++){let g=c.children[h];if(g.localName!=="Name")continue;let d=F(g,"Type");if(d==="FirstName"){let C=parseInt(F(g,"Order")||"9999",10);isNaN(C)&&(C=9999),a.push({o:C,v:F(g,"Value")})}else d==="LastName"&&(m=F(g,"Value")||m)}a.sort(function(h,g){return h.o-g.o});let p=[];for(let h=0;h<a.length;h++)p.push(a[h].v);b=(p.join(" ")+" "+m).trim()}let y=document.createElement("strong");y.textContent=b||"-",r.appendChild(y);let N=document.createElement("div");N.className="gpiv-inline-xml mt-2 d-none";let v=F(s,"PublicId")||F(s,"PersonId"),T=(F(s,"DateOfBirth")||"").slice(0,10);if(l.dataset.name=b||"",l.dataset.publicId=v||"",l.dataset.dob=T||"",v)try{l.setAttribute("data-public-id",v)}catch(a){u("gpiv:setAttribute-publicId",a)}T&&r.appendChild(ht((f.DOB||"DOB")+": "+T));try{let a=bt(N);a&&r.appendChild(a)}catch(a){u("gpiv:createRawPrettyButtons",a)}try{r.appendChild(function(){let a=f&&(f.Details||f.PersonDetails)?f.Details||f.PersonDetails:"Details",m=document.createElement("button");return m.type="button",m.className="btn btn-sm btn-outline-primary ms-auto gpiv-more-info-btn",m.setAttribute("title",f.PersonDetails||a),m.setAttribute("aria-label",f.PersonDetails||a),m.innerHTML='<i class="bi bi-info-circle me-1" aria-hidden="true"></i>'+a,m.addEventListener("click",function(){let p=document.getElementById("pd-details-panel"),h=p&&p.classList.contains("show"),g=typeof window<"u"&&window.lastPid?window.lastPid:"";if(h&&g&&v&&g===v){try{window.bootstrap&&window.bootstrap.Collapse?window.bootstrap.Collapse.getOrCreateInstance(p,{toggle:!1}).hide():p.classList.remove("show")}catch(d){u("gpiv:toggleDetailsHide",d)}return}try{window.lastPid=v||window.lastPid}catch(d){u("gpiv:setLastPid",d)}try{p&&(window.bootstrap&&window.bootstrap.Collapse?window.bootstrap.Collapse.getOrCreateInstance(p,{toggle:!1}).show():p.classList.add("show"))}catch(d){u("gpiv:toggleDetailsShow",d)}try{let d=document.getElementById("gpiv-tab-details-btn");d&&d.click()}catch(d){u("gpiv:triggerDetailsTab",d)}}),m}())}catch(a){u("gpiv:addDetailsButton",a)}l.appendChild(r),l.appendChild(N);let P=ct("acc"),L=document.createElement("div");if(L.className="accordion",L.id=P,L.addEventListener("show.bs.collapse",function(a){try{let m=a&&a.target?a.target:null;if(!m)return;let p=m.querySelector(".accordion-body");p&&p.dataset.rendered!=="1"&&typeof p._render=="function"&&(p._render(),p.dataset.rendered="1")}catch(m){u("gpiv:lazyRender",m)}}),c){let a=z(P,L.childElementCount,f.Names||"Names",!1);a.body._render=function(m,p){return function(){try{O(p);let h=document.createElement("div");h.className="d-flex flex-column gap-2";let g=[];for(let d=0;d<m.children.length;d++){let C=m.children[d];if(C.localName!=="Name")continue;let A=parseInt(F(C,"Order")||"9999",10);isNaN(A)&&(A=9999),g.push({node:C,order:A})}g.sort(function(d,C){return d.order-C.order});for(let d=0;d<g.length;d++){let C=g[d].node,A=k("div","p-2 border rounded",null),K=k("div","small text-muted mb-1",(f.Name||"Name")+" #"+(d+1));A.appendChild(K);let R=V(C);R&&A.appendChild(R);let W=_(C);W&&W.childElementCount>(R?1:0)&&A.appendChild(W),h.appendChild(A)}p.appendChild(h)}catch(h){u("gpiv:renderNames",h)}}}(c,a.body),L.appendChild(a.item)}let ot=V(s);if(ot){let a=z(P,L.childElementCount,f.Basics||"Basics",!1);a.body._render=function(m,p){return function(){try{O(p),p.appendChild(m)}catch(h){u("gpiv:renderBasics",h)}}}(ot,a.body),L.appendChild(a.item)}let J=et(s);for(let a in J)Object.prototype.hasOwnProperty.call(J,a)&&function(m,p){let h=z(P,L.childElementCount,m,!1);h.body._render=function(){try{O(h.body);let g=document.createElement("div");if(g.className="d-flex flex-column gap-2",p.length>1){let d=document.createElement("div");d.className="d-flex flex-column gap-2";for(let C=0;C<p.length;C++){let A=k("div","p-2 border rounded",null),K=k("div","small text-muted mb-1",m+" #"+(C+1));A.appendChild(K);let R=_(p[C]);R&&A.appendChild(R),d.appendChild(A)}g.appendChild(d)}else{let d=_(p[0]);d&&g.appendChild(d)}h.body.appendChild(g)}catch(g){u("gpiv:renderGroup:"+m,g)}},L.appendChild(h.item)}(a,J[a]);l.appendChild(L),o.appendChild(l)}x.appendChild(o);try{st(x)}catch(i){u("gpiv:focusFirstAccordionButton-final",i)}try{let i=w("pd-toggle-details");i&&(i.classList.add("d-none"),i.setAttribute("aria-hidden","true"))}catch(i){u("gpiv:hideOldDetailsBtn",i)}S()}catch(t){console.error("gpiv: failed to build summary",t),x.textContent=(f.FailedToBuildSummaryPrefix||"Failed to build summary:")+" "+(t&&t.message?t.message:t),S()}}function G(){let e=(I&&I.trim()||D&&D.trim()||"").length>0;q&&(q.style.display=e?"none":"block"),e?yt():(O(x),S())}function nt(t,e){try{let n=w("gpiv-raw-pre"),o=w("gpiv-pretty-pre");n&&(n.textContent=t||""),o&&(o.textContent=e||t||"");let i=w("gpiv-copy-raw"),s=w("gpiv-copy-pretty"),l=w("gpiv-dl-raw"),r=w("gpiv-dl-pretty");i&&(i.onclick=function(){H(t||"").then(function(){i.textContent=f.Copied||"Copied",setTimeout(function(){i.textContent=f.Copy||"Copy"},1200)}).catch(function(c){u("gpiv:copyRaw",c)})}),s&&(s.onclick=function(){H(e||t||"").then(function(){s.textContent=f.Copied||"Copied",setTimeout(function(){s.textContent=f.Copy||"Copy"},1200)}).catch(function(c){u("gpiv:copyPretty",c)})}),l&&(l.onclick=function(){try{X("GetPeoplePublicInfo_raw_"+new Date().toISOString().replace(/[:.]/g,"-")+".xml",t||"","text/xml;charset=utf-8")}catch(c){u("gpiv:downloadRaw",c)}}),r&&(r.onclick=function(){try{let c=e||t||"";X("GetPeoplePublicInfo_pretty_"+new Date().toISOString().replace(/[:.]/g,"-")+".xml",c,"text/xml;charset=utf-8")}catch(c){u("gpiv:downloadPretty",c)}})}catch(n){u("gpiv:setRawPrettyUi",n)}}function xt(t){!t||!t.trim()||(I=t,D=t,nt(I,D),G())}function vt(){document.addEventListener("click",function(t){let e=t&&t.target?t.target:null;if(!(!e||!(e.id==="gpiv-fullscreen"||e.closest&&e.closest("#gpiv-fullscreen")))&&E){try{let o=w("person-details-section");o&&o.classList.remove("pd-fullscreen")}catch(o){u("gpiv:exitPersonDetailsFs",o)}try{lt(E,"gpiv-fullscreen"),!document.fullscreenElement&&!E.classList.contains("gpiv-fullscreen")&&S()}catch{E.classList.toggle("gpiv-fullscreen"),E.style.height="",E.classList.contains("gpiv-fullscreen")||S()}}}),document.addEventListener("fullscreenchange",function(){if(!E)return;let t=document.fullscreenElement===E;E.classList.toggle("gpiv-fullscreen",t),t||S()})}function Ct(){try{let t=w("gpiv-i18n-json");t&&(f=JSON.parse(t.textContent||"{}"))}catch(t){console.error("gpiv: failed to parse i18n json",t)}try{let t=w("gpiv-raw-json"),e=w("gpiv-pretty-json"),n=t?JSON.parse(t.textContent||'""'):"",o=e?JSON.parse(e.textContent||'""'):"";if((typeof n=="string"||typeof o=="string")&&window.gpiv.setXml(String(n||""),String(o||"")),(!n||n.length===0)&&(!o||o.length===0)){let i=w("gpiv-data");if(i){let s=i.getAttribute("data-raw-b64")||"",l=i.getAttribute("data-pretty-b64")||"";try{let r=s?Y(s):"",c=l?Y(l):"";(r||c)&&window.gpiv.setXml(r,c)}catch(r){console.error("gpiv: base64 decode failed",r)}}}}catch(t){console.error("gpiv: failed to parse initial xml json",t)}}function wt(){try{let e=new URLSearchParams(window.location.search).get("gpivPublicId");e&&setTimeout(function(){window.gpiv.focusPerson(e)},50)}catch(t){console.error("gpiv: focusPerson failed",t)}}window.gpiv={setXml:function(t,e){try{typeof t=="string"&&(I=t),typeof e=="string"?D=e:typeof t=="string"&&(D=t),nt(I,D),G()}catch(n){console.error("gpiv: setXml failed",n)}},focusPerson:function(t){try{if(!t)return;G();let e=ut(".gpiv-person[data-public-id]",x);for(let n=0;n<e.length;n++)if((e[n].getAttribute("data-public-id")||(e[n].dataset?e[n].dataset.publicId:""))===t){e[n].scrollIntoView&&(e[n].scrollIntoView({block:"center"}),e[n].classList.add("gpiv-highlight"),setTimeout(function(i){return function(){i.classList.remove("gpiv-highlight")}}(e[n]),1500));break}}catch(e){console.error("gpiv: focusPerson failed",e)}}},document.addEventListener("DOMContentLoaded",function(){try{x=w("gpiv-xml-summary"),q=w("gpiv-empty"),E=dt(".gpiv-card");try{let t=w("people-search-card");window.ResizeObserver&&t&&new ResizeObserver(function(){S()}).observe(t)}catch(t){console.error("gpiv: ResizeObserver failed",t)}window.addEventListener("resize",S),vt(),document.addEventListener("keydown",function(t){try{rt(t,x)}catch(e){u("gpiv:handleAccordionKeydown",e)}}),document.addEventListener("click",function(t){try{(t.target&&t.target.closest?t.target.closest("#gpiv-expand-all"):null)&&tt(!0)}catch(e){u("gpiv:expandAll",e)}try{(t.target&&t.target.closest?t.target.closest("#gpiv-collapse-all"):null)&&tt(!1)}catch(e){u("gpiv:collapseAll",e)}}),Ct(),wt(),S()}catch(t){console.error("gpiv: init failed",t),x&&(x.textContent=(f.FailedToBuildSummaryPrefix||"Failed to initialize:")+" "+(t&&t.message?t.message:t))}})})();
