(function(){"use strict";function d(t,e){try{if(!e)return;window&&window.console&&console.debug&&console.debug(t,e)}catch{}}function Y(t){try{if(!t)return"";let e=atob(t);if(!/[\x80-\xFF]/.test(e))return e;let n=Uint8Array.from(e,i=>i.charCodeAt(0));return new TextDecoder("utf-8",{fatal:!1}).decode(n)}catch(e){return d("gpiv:b64ToUtf8",e),""}}let S=typeof window<"u"&&window.gpivHelpers?window.gpivHelpers:{},ct=S.iconClassFor||function(){return"bi-list-ul"},Et=S.prettify||(t=>String(t||"")),rt=S.nextUid||(t=>(t||"id")+"-"+Date.now()),O=S.clearChildren||function(t){try{for(;t&&t.firstChild;)t.removeChild(t.firstChild)}catch(e){d("gpiv:clearChildren",e)}},st=S.handleAccordionKeydown||function(){},j=S.copyToClipboard||async function(){return!1},H=S.downloadBlob||function(){},at=S.toggleFullscreenWithCssFallback||function(t,e){t&&t.classList&&t.classList.toggle(e)},lt=S.focusFirstAccordionButton||function(t){try{let e=(t||document).querySelector(".accordion .accordion-header .accordion-button");e&&e.focus&&e.focus()}catch(e){d("gpiv:focusFirstAccordionButton",e)}},dt=S.toggleAllAccordions||function(t,e){try{let n=(t||document).querySelectorAll(".accordion-collapse")||[];for(let o=0;o<n.length;o++){let a=n[o];a&&a.classList.toggle("show",!!e)}let i=(t||document).querySelectorAll(".accordion-button")||[];for(let o=0;o<i.length;o++){let a=i[o];a&&(a.classList.toggle("collapsed",!e),a.setAttribute("aria-expanded",e?"true":"false"))}}catch(n){d("gpiv:toggleAllAccordions",n)}};function N(t){return document.getElementById(t)}function ut(t,e){return(e||document).querySelector(t)}function pt(t,e){return(e||document).querySelectorAll(t)}function B(t,e,n){let i=document.createElement(t);return e&&(i.className=e),n!=null&&(i.textContent=n),i}let E=null,q=null,P=null,p={},k="",A="";function ft(){try{let t=N("gpiv-opts");if(!t)return{showRaw:!0,showPretty:!0};let e=(t.getAttribute("data-show-raw")||"true").toLowerCase()==="true",n=(t.getAttribute("data-show-pretty")||"true").toLowerCase()==="true";return{showRaw:e,showPretty:n}}catch(t){return d("gpiv:readViewerFlags",t),{showRaw:!0,showPretty:!0}}}let $={showRaw:!0,showPretty:!0};function mt(t){let n=new DOMParser().parseFromString(t,"application/xml"),i=n.querySelector("parsererror");if(i)throw new Error(i.textContent||"Invalid XML");return n}function Q(){try{let t=N("people-search-card");if(!t||!P)return;if(P.classList.contains("gpiv-fullscreen")){P.style.height="";return}let e=Math.round(t.getBoundingClientRect().height);e>0&&(P.style.height=e+"px")}catch(t){console.error("gpiv: syncViewerHeight failed",t)}}let X=0,ht=75;function I(){try{X&&clearTimeout(X)}catch(t){d("gpiv:scheduleHeightSync-clearTimeout",t)}X=setTimeout(function(){X=0;try{(window.requestAnimationFrame||function(t){return setTimeout(t,16)})(function(){Q()})}catch(t){d("gpiv:scheduleHeightSync-rAF",t),Q()}},ht)}function gt(t,e){t.textContent="";let n=document.createElement("i");n.className="bi "+ct(e)+" me-2",n.setAttribute("aria-hidden","true"),t.appendChild(n),t.appendChild(document.createTextNode(e||""))}function M(t){if(!t||t.nodeType!==1||!t.attributes)return!1;for(let e=0;e<t.attributes.length;e++){let n=t.attributes[e];if((n.localName||n.name)==="nil"&&/^(true|1)$/i.test((n.value||"").trim()))return!0}return!1}function Z(t){if(!t||!t.children)return!1;for(let e=0;e<t.children.length;e++)if(!M(t.children[e]))return!0;return!1}function U(t){if(!t)return!1;let e=String(t).toLowerCase();return e==="id"||e==="personaddressid"}let tt="@";function V(t){let e=[];if(t&&t.attributes&&t.attributes.length)for(let s=0;s<t.attributes.length;s++){let r=t.attributes[s],c=r.localName||r.name||"";U(c)||e.push({key:tt+(r.name||""),val:r.value||""})}let n=t&&t.children?t.children:[];for(let s=0;s<n.length;s++){let r=n[s],c=M(r);if(c||!Z(r)){if(U(r.localName))continue;let v=c?"":(r.textContent||"").trim();if(e.push({key:r.localName,val:v}),!c&&r.attributes&&r.attributes.length)for(let m=0;m<r.attributes.length;m++){let y=r.attributes[m],C=y.localName||y.name||"";U(C)||e.push({key:r.localName+" "+tt+(y.name||""),val:y.value||""})}}}if(!e.length)return null;let i=document.createElement("div");i.className="table-responsive";let o=document.createElement("table");o.className="table table-sm table-striped align-middle mb-0";let a=document.createElement("tbody");for(let s=0;s<e.length;s++){let r=document.createElement("tr"),c=document.createElement("th");c.className="text-muted fw-normal",c.style.width="36%",c.textContent=e[s].key;let b=document.createElement("td");b.textContent=e[s].val,r.appendChild(c),r.appendChild(b),a.appendChild(r)}return o.appendChild(a),i.appendChild(o),i}function D(t,e){if(!t||!t.children)return"";for(let n=0;n<t.children.length;n++){let i=t.children[n];if(i.localName===e)return(i.textContent||"").trim()}return""}function bt(t){let e=document.createElement("span");return e.className="badge text-bg-light",e.textContent=t,e}function G(t,e,n,i){let o=document.createElement("div");o.className="accordion-item";let a=t+"-h-"+e,s=t+"-c-"+e,r=document.createElement("h2");r.className="accordion-header",r.id=a;let c=document.createElement("button");c.type="button",c.className="accordion-button"+(i?"":" collapsed"),c.setAttribute("data-bs-toggle","collapse"),c.setAttribute("data-bs-target","#"+s),c.setAttribute("aria-expanded",i?"true":"false"),c.setAttribute("aria-controls",s),gt(c,n||""),r.appendChild(c);let b=document.createElement("div");b.id=s,b.className="accordion-collapse collapse"+(i?" show":""),b.setAttribute("aria-labelledby",a);let v=document.createElement("div");return v.className="accordion-body p-0",v.dataset.rendered="0",b.appendChild(v),o.appendChild(r),o.appendChild(b),{item:o,body:v}}function et(t){E&&dt(E,t)}function nt(t){let e=Object.create(null);if(!t||!t.children)return e;for(let n=0;n<t.children.length;n++){let i=t.children[n];if(!i||i.nodeType!==1||i.localName==="Names"||M(i)||!Z(i))continue;let o=i.localName;(e[o]||(e[o]=[])).push(i)}return e}function yt(t){let e=[],n=t.getElementsByTagName("*");for(let i=0;i<n.length;i++)n[i].localName==="PersonPublicInfo"&&e.push(n[i]);if(e.length>0)return e;for(let i=0;i<n.length;i++)n[i].localName==="Person"&&e.push(n[i]);if(e.length>0,e)return e;for(let i=0;i<n.length;i++){let o=n[i],a=o.localName;if(!o.children||a==="Names"||a==="Name"||a==="ListOfPersonPublicInfo"||a==="ListOfPersonPublicInfoCriteria")continue;let s=!1,r=!1;for(let c=0;c<o.children.length;c++){let v=o.children[c].localName;(v==="PublicId"||v==="PersonId")&&(s=!0),v==="Names"&&(r=!0)}(s||r)&&e.push(o)}return e}function vt(t){let e=document.createElement("div");e.className="btn-group btn-group-sm align-self-center ms-2";let n=$||{showRaw:!0,showPretty:!0};function i(o){if(!t)return;let a=t.getAttribute("data-mode")||"";if(!t.classList.contains("d-none")&&a===o){t.classList.add("d-none");return}t.setAttribute("data-mode",o),t.classList.remove("d-none"),O(t);let r=o==="raw"?A||"":k||A||"",c=document.createElement("div");c.className="p-2 border rounded bg-body-tertiary";let b=document.createElement("div");if(b.className="d-flex justify-content-end gap-2 mb-2",o==="raw"&&n.showRaw){let m=document.createElement("button");m.type="button",m.className="btn btn-sm btn-outline-secondary",m.textContent=p.Copy||"Copy",m.addEventListener("click",function(){j(r).then(function(){let C=m.textContent;m.textContent=p.Copied||"Copied",setTimeout(function(){m.textContent=C},1200)}).catch(function(C){d("gpiv:copy-inline",C)})});let y=document.createElement("button");y.type="button",y.className="btn btn-sm btn-outline-secondary",y.textContent=p.Download||"Download",y.addEventListener("click",function(){try{let F="GetPeoplePublicInfo_raw_"+new Date().toISOString().replace(/[:.]/g,"-")+".xml";H(F,r,"text/xml;charset=utf-8")}catch(C){d("gpiv:download-inline",C)}}),b.appendChild(m),b.appendChild(y)}if(o==="pretty"&&n.showPretty){let m=document.createElement("button");m.type="button",m.className="btn btn-sm btn-outline-secondary",m.textContent=p.Copy||"Copy",m.addEventListener("click",function(){j(r).then(function(){let C=m.textContent;m.textContent=p.Copied||"Copied",setTimeout(function(){m.textContent=C},1200)}).catch(function(C){d("gpiv:copy-inline-pretty",C)})});let y=document.createElement("button");y.type="button",y.className="btn btn-sm btn-outline-secondary",y.textContent=p.Download||"Download",y.addEventListener("click",function(){try{let F="GetPeoplePublicInfo_pretty_"+new Date().toISOString().replace(/[:.]/g,"-")+".xml";H(F,r,"text/xml;charset=utf-8")}catch(C){d("gpiv:download-inline-pretty",C)}}),b.appendChild(m),b.appendChild(y)}let v=document.createElement("pre");v.className="gpiv-pre mb-0",v.style.maxHeight="16rem",v.style.overflow="auto",v.textContent=r,c.appendChild(b),c.appendChild(v),t.appendChild(c)}if(n.showRaw){let o=document.createElement("button");o.type="button",o.className="btn btn-outline-secondary",o.innerHTML='<i class="bi bi-filetype-xml me-1" aria-hidden="true"></i>'+(p.RawXml||"Raw XML"),o.addEventListener("click",function(){i("raw")}),e.appendChild(o)}if(n.showPretty){let o=document.createElement("button");o.type="button",o.className="btn btn-outline-secondary",o.innerHTML='<i class="bi bi-braces-asterisk me-1" aria-hidden="true"></i>'+(p.PrettyXml||"Pretty XML"),o.addEventListener("click",function(){i("pretty")}),e.appendChild(o)}return e}function _(t){let e=document.createElement("div");e.className="d-flex flex-column gap-2";let n=V(t);n&&e.appendChild(n);let i=nt(t);for(let o in i){if(!Object.prototype.hasOwnProperty.call(i,o))continue;let a=i[o];if(a.length>1){let s=document.createElement("div");s.className="d-flex flex-column gap-2";for(let r=0;r<a.length;r++){let c=B("div","p-2 border rounded",null),b=B("div","small text-muted mb-1",o+" #"+(r+1));c.appendChild(b);let v=_(a[r]);v&&c.appendChild(v),s.appendChild(c)}e.appendChild(s)}else{let s=_(a[0]),r=B("div","small text-muted mb-1",o),c=document.createElement("div");c.className="p-2 border rounded",c.appendChild(r),s&&c.appendChild(s),e.appendChild(c)}}return e}function wt(){O(E);try{let t=A&&A.trim()?A:k||"";if(!t.trim()){E.textContent=p.NoXmlToDisplay||"No XML to display.",I();return}let e=mt(t),n=yt(e);if(!n||n.length===0){E.appendChild(B("div","text-muted",p.NoPeopleFound||"No people found.")),I();return}let i=document.createDocumentFragment();for(let o=0;o<n.length;o++){let a=n[o],s=document.createElement("div");s.className="mb-3 p-2 border rounded gpiv-person",s.setAttribute("data-idx",String(o));let r=B("div","gpiv-person-header d-flex flex-wrap gap-2 align-items-baseline mb-2",null);r.appendChild(B("span","badge text-bg-secondary","#"+(o+1)));let c=null;for(let l=0;l<a.children.length;l++)if(a.children[l].localName==="Names"){c=a.children[l];break}let b="";if(c){let l=[],h="";for(let g=0;g<c.children.length;g++){let w=c.children[g];if(w.localName!=="Name")continue;let u=D(w,"Type");if(u==="FirstName"){let x=parseInt(D(w,"Order")||"9999",10);isNaN(x)&&(x=9999),l.push({o:x,v:D(w,"Value")})}else u==="LastName"&&(h=D(w,"Value")||h)}l.sort(function(g,w){return g.o-w.o});let f=[];for(let g=0;g<l.length;g++)f.push(l[g].v);b=(f.join(" ")+" "+h).trim()}let v=document.createElement("strong");v.textContent=b||"-",r.appendChild(v);let m=document.createElement("div");m.className="gpiv-inline-xml mt-2 d-none";let y=D(a,"PublicId")||D(a,"PersonId"),C=(D(a,"DateOfBirth")||"").slice(0,10);if(s.dataset.name=b||"",s.dataset.publicId=y||"",s.dataset.dob=C||"",y)try{s.setAttribute("data-public-id",y)}catch(l){d("gpiv:setAttribute-publicId",l)}C&&r.appendChild(bt((p.DOB||"DOB")+": "+C));try{let l=vt(m);l&&r.appendChild(l)}catch(l){d("gpiv:createRawPrettyButtons",l)}try{r.appendChild(function(){let l=p&&(p.Details||p.PersonDetails)?p.Details||p.PersonDetails:"Details",h=document.createElement("button");return h.type="button",h.className="btn btn-sm btn-outline-primary ms-auto gpiv-more-info-btn",h.setAttribute("title",p.PersonDetails||l),h.setAttribute("aria-label",p.PersonDetails||l),h.innerHTML='<i class="bi bi-info-circle me-1" aria-hidden="true"></i>'+l,h.addEventListener("click",function(){let f=document.getElementById("pd-details-panel"),g=f&&f.classList.contains("show"),w=typeof window<"u"&&window.lastPid?window.lastPid:"";if(g&&w&&y&&w===y){try{window.bootstrap&&window.bootstrap.Collapse?window.bootstrap.Collapse.getOrCreateInstance(f,{toggle:!1}).hide():f.classList.remove("show")}catch(u){d("gpiv:toggleDetailsHide",u)}return}try{window.lastPid=y||window.lastPid}catch(u){d("gpiv:setLastPid",u)}try{f&&(window.bootstrap&&window.bootstrap.Collapse?window.bootstrap.Collapse.getOrCreateInstance(f,{toggle:!1}).show():f.classList.add("show"))}catch(u){d("gpiv:toggleDetailsShow",u)}try{let u=document.getElementById("gpiv-tab-details-btn");u&&u.click()}catch(u){d("gpiv:triggerDetailsTab",u)}}),h}())}catch(l){d("gpiv:addDetailsButton",l)}s.appendChild(r),s.appendChild(m);let F=rt("acc"),T=document.createElement("div");if(T.className="accordion",T.id=F,T.addEventListener("show.bs.collapse",function(l){try{let h=l&&l.target?l.target:null;if(!h)return;let f=h.querySelector(".accordion-body");f&&f.dataset.rendered!=="1"&&typeof f._render=="function"&&(f._render(),f.dataset.rendered="1")}catch(h){d("gpiv:lazyRender",h)}}),c){let l=G(F,T.childElementCount,p.Names||"Names",!1);l.body._render=function(h,f){return function(){try{O(f);let g=document.createElement("div");g.className="d-flex flex-column gap-2";let w=[];for(let u=0;u<h.children.length;u++){let x=h.children[u];if(x.localName!=="Name")continue;let L=parseInt(D(x,"Order")||"9999",10);isNaN(L)&&(L=9999),w.push({node:x,order:L})}w.sort(function(u,x){return u.order-x.order});for(let u=0;u<w.length;u++){let x=w[u].node,L=B("div","p-2 border rounded",null),K=B("div","small text-muted mb-1",(p.Name||"Name")+" #"+(u+1));L.appendChild(K);let R=V(x);R&&L.appendChild(R);let W=_(x);W&&W.childElementCount>(R?1:0)&&L.appendChild(W),g.appendChild(L)}f.appendChild(g)}catch(g){d("gpiv:renderNames",g)}}}(c,l.body),T.appendChild(l.item)}let it=V(a);if(it){let l=G(F,T.childElementCount,p.Basics||"Basics",!1);l.body._render=function(h,f){return function(){try{O(f),f.appendChild(h)}catch(g){d("gpiv:renderBasics",g)}}}(it,l.body),T.appendChild(l.item)}let J=nt(a);for(let l in J)Object.prototype.hasOwnProperty.call(J,l)&&function(h,f){let g=G(F,T.childElementCount,h,!1);g.body._render=function(){try{O(g.body);let w=document.createElement("div");if(w.className="d-flex flex-column gap-2",f.length>1){let u=document.createElement("div");u.className="d-flex flex-column gap-2";for(let x=0;x<f.length;x++){let L=B("div","p-2 border rounded",null),K=B("div","small text-muted mb-1",h+" #"+(x+1));L.appendChild(K);let R=_(f[x]);R&&L.appendChild(R),u.appendChild(L)}w.appendChild(u)}else{let u=_(f[0]);u&&w.appendChild(u)}g.body.appendChild(w)}catch(w){d("gpiv:renderGroup:"+h,w)}},T.appendChild(g.item)}(l,J[l]);s.appendChild(T),i.appendChild(s)}E.appendChild(i);try{lt(E)}catch(o){d("gpiv:focusFirstAccordionButton-final",o)}try{let o=N("pd-toggle-details");o&&(o.classList.add("d-none"),o.setAttribute("aria-hidden","true"))}catch(o){d("gpiv:hideOldDetailsBtn",o)}I()}catch(t){console.error("gpiv: failed to build summary",t),E.textContent=(p.FailedToBuildSummaryPrefix||"Failed to build summary:")+" "+(t&&t.message?t.message:t),I()}}function z(){let e=(A&&A.trim()||k&&k.trim()||"").length>0;q&&(q.style.display=e?"none":"block"),e?wt():(O(E),I())}function ot(t,e){try{let n=N("gpiv-raw-pre"),i=N("gpiv-pretty-pre");n&&(n.textContent=t||""),i&&(i.textContent=e||t||"");let o=N("gpiv-copy-raw"),a=N("gpiv-copy-pretty"),s=N("gpiv-dl-raw"),r=N("gpiv-dl-pretty");o&&(o.onclick=function(){j(t||"").then(function(){o.textContent=p.Copied||"Copied",setTimeout(function(){o.textContent=p.Copy||"Copy"},1200)}).catch(function(c){d("gpiv:copyRaw",c)})}),a&&(a.onclick=function(){j(e||t||"").then(function(){a.textContent=p.Copied||"Copied",setTimeout(function(){a.textContent=p.Copy||"Copy"},1200)}).catch(function(c){d("gpiv:copyPretty",c)})}),s&&(s.onclick=function(){try{H("GetPeoplePublicInfo_raw_"+new Date().toISOString().replace(/[:.]/g,"-")+".xml",t||"","text/xml;charset=utf-8")}catch(c){d("gpiv:downloadRaw",c)}}),r&&(r.onclick=function(){try{let c=e||t||"";H("GetPeoplePublicInfo_pretty_"+new Date().toISOString().replace(/[:.]/g,"-")+".xml",c,"text/xml;charset=utf-8")}catch(c){d("gpiv:downloadPretty",c)}})}catch(n){d("gpiv:setRawPrettyUi",n)}}function Pt(t){!t||!t.trim()||(A=t,k=t,ot(A,k),z())}function Ct(){document.addEventListener("click",function(t){let e=t&&t.target?t.target:null;if(!(!e||!(e.id==="gpiv-fullscreen"||e.closest&&e.closest("#gpiv-fullscreen")))&&P){try{let i=N("person-details-section");i&&i.classList.remove("pd-fullscreen")}catch(i){d("gpiv:exitPersonDetailsFs",i)}try{at(P,"gpiv-fullscreen"),!document.fullscreenElement&&!P.classList.contains("gpiv-fullscreen")&&I()}catch{P.classList.toggle("gpiv-fullscreen"),P.style.height="",P.classList.contains("gpiv-fullscreen")||I()}}}),document.addEventListener("fullscreenchange",function(){if(!P)return;let t=document.fullscreenElement===P;P.classList.toggle("gpiv-fullscreen",t),t||I()})}function Nt(){try{let t=N("gpiv-i18n-json");t&&(p=JSON.parse(t.textContent||"{}"))}catch(t){console.error("gpiv: failed to parse i18n json",t)}try{let t=N("gpiv-raw-json"),e=N("gpiv-pretty-json"),n=t?JSON.parse(t.textContent||'""'):"",i=e?JSON.parse(e.textContent||'""'):"";if((typeof n=="string"||typeof i=="string")&&window.gpiv.setXml(String(n||""),String(i||"")),(!n||n.length===0)&&(!i||i.length===0)){let o=N("gpiv-data");if(o){let a=o.getAttribute("data-raw-b64")||"",s=o.getAttribute("data-pretty-b64")||"";try{let r=a?Y(a):"",c=s?Y(s):"";(r||c)&&window.gpiv.setXml(r,c)}catch(r){console.error("gpiv: base64 decode failed",r)}}}}catch(t){console.error("gpiv: failed to parse initial xml json",t)}}function xt(){try{let e=new URLSearchParams(window.location.search).get("gpivPublicId");e&&setTimeout(function(){window.gpiv.focusPerson(e)},50)}catch(t){console.error("gpiv: focusPerson failed",t)}}window.gpiv={setXml:function(t,e){try{typeof t=="string"&&(A=t),typeof e=="string"?k=e:typeof t=="string"&&(k=t),ot(A,k),z()}catch(n){console.error("gpiv: setXml failed",n)}},focusPerson:function(t){try{if(!t)return;z();let e=pt(".gpiv-person[data-public-id]",E);for(let n=0;n<e.length;n++)if((e[n].getAttribute("data-public-id")||(e[n].dataset?e[n].dataset.publicId:""))===t){e[n].scrollIntoView&&(e[n].scrollIntoView({block:"center"}),e[n].classList.add("gpiv-highlight"),setTimeout(function(o){return function(){o.classList.remove("gpiv-highlight")}}(e[n]),1500));break}}catch(e){console.error("gpiv: focusPerson failed",e)}}},document.addEventListener("DOMContentLoaded",function(){try{$=ft(),E=N("gpiv-xml-summary"),q=N("gpiv-empty"),P=ut(".gpiv-card");try{let t=N("people-search-card");window.ResizeObserver&&t&&new ResizeObserver(function(){I()}).observe(t)}catch(t){console.error("gpiv: ResizeObserver failed",t)}window.addEventListener("resize",I),Ct(),document.addEventListener("keydown",function(t){try{st(t,E)}catch(e){d("gpiv:handleAccordionKeydown",e)}}),document.addEventListener("click",function(t){try{(t.target&&t.target.closest?t.target.closest("#gpiv-expand-all"):null)&&et(!0)}catch(e){d("gpiv:expandAll",e)}try{(t.target&&t.target.closest?t.target.closest("#gpiv-collapse-all"):null)&&et(!1)}catch(e){d("gpiv:collapseAll",e)}}),Nt(),xt(),I()}catch(t){console.error("gpiv: init failed",t),E&&(E.textContent=(p.FailedToBuildSummaryPrefix||"Failed to initialize:")+" "+(t&&t.message?t.message:t))}})})();
