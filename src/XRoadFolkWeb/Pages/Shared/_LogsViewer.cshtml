@using XRoadFolkWeb.Shared
@inject Microsoft.Extensions.Localization.IStringLocalizer<SharedResource> SR
@{
  var nonce = Context?.Items?["CSP_NONCE"] as string;
}
<section class="card shadow-sm" id="logs-section" aria-labelledby="logs-heading">
  <div class="card-body">
    <div class="d-flex justify-content-between align-items-center mb-2 position-sticky sticky-top bg-body" style="top: -1px; z-index: 2; padding-top:.25rem; padding-bottom:.25rem;" role="toolbar" aria-label="@SR["LogsToolbar"]">
      <div class="d-flex align-items-center gap-2 flex-wrap">
        <a asp-page="/Index" class="btn btn-sm btn-outline-dark" id="logs-back" aria-label="@SR["Back"]"><i class="bi bi-arrow-left me-1" aria-hidden="true"></i>@SR["Back"]</a>
        <div class="btn-group btn-group-sm" role="group" aria-label="@SR["Kind"]">
          <button type="button" class="btn btn-outline-dark active" data-kind="http" aria-pressed="true">@SR["HTTP"]</button>
          <button type="button" class="btn btn-outline-dark" data-kind="soap" aria-pressed="false">@SR["SOAP"]</button>
          <button type="button" class="btn btn-outline-dark" data-kind="app" aria-pressed="false">@SR["App"]</button>
        </div>
        <div class="btn-group btn-group-sm ms-1" role="group" aria-label="@SR["View"]">
          <button type="button" class="btn btn-outline-dark active" data-view="table" aria-pressed="true">@SR["Table"]</button>
          <button type="button" class="btn btn-outline-dark" data-view="cards" aria-pressed="false">@SR["Cards"]</button>
        </div>
        <h2 class="card-title mb-0 ms-2 h5" id="logs-heading">@SR["Logs"]</h2>
        <span class="badge text-bg-secondary ms-1" id="logs-count" aria-live="polite">0</span>
      </div>
      <div class="d-flex gap-2 flex-wrap">
        <button class="btn btn-sm btn-outline-dark" id="logs-clear" aria-label="@SR["ClearLogs"]">@SR["Clear"]</button>
        <button class="btn btn-sm btn-outline-dark" id="logs-pause" aria-label="@SR["PauseOrResumeLiveStream"]" data-i18n-pause="@SR["Pause"]" data-i18n-resume="@SR["Resume"]">@SR["Pause"]</button>
        <button class="btn btn-sm btn-outline-dark" id="logs-download" aria-label="@SR["DownloadVisibleAsJson"]">@SR["Download"]</button>
      </div>
    </div>

    <div class="row g-2 align-items-center mb-2">
      <div class="col-sm-8">
        <div class="logs-filter-group">
          <label for="logs-filter" class="form-label visually-hidden">@SR["Filter"]</label>
          <div class="input-group input-group-sm">
            <span class="input-group-text" id="logs-filter-label">@SR["Filter"]</span>
            <input type="text" class="form-control" id="logs-filter" aria-labelledby="logs-filter-label" placeholder="@SR["SearchInMessageOrCategory"]">
            <label for="logs-level" class="form-label visually-hidden">@SR["Level"]</label>
            <select class="form-select" id="logs-level" style="max-width:12rem;" aria-label="@SR["Level"]">
              <option value="">@SR["AnyLevel"]</option>
              <option>@SR["Trace"]</option>
              <option>@SR["Debug"]</option>
              <option>@SR["Information"]</option>
              <option>@SR["Warning"]</option>
              <option>@SR["Error"]</option>
              <option>@SR["Critical"]</option>
            </select>
          </div>
        </div>
      </div>
      <div class="col-sm-4 text-sm-end small text-muted" id="logs-status" aria-live="polite"></div>
    </div>

    <div class="logs-container" aria-live="polite">
      <div class="table-responsive logs-table-container" style="max-height: 65vh;" role="region" aria-label="@SR["LogsTableRegion"]">
        <table class="table table-sm table-striped align-middle" id="logs-table">
          <thead class="table-light position-sticky thead-sticky" style="top:0; z-index:1;">
            <tr>
              <th class="th-width-ts" scope="col">@SR["TimestampLocal"]</th>
              <th class="th-width-lvl" scope="col">@SR["Level"]</th>
              <th scope="col">@SR["Category"]</th>
              <th scope="col">@SR["Message"]</th>
              <th class="text-end" style="width:6rem;" scope="col">@SR["Actions"]</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="logs-cards" class="row row-cols-1 row-cols-md-2 g-2 d-none" aria-hidden="true"></div>
    </div>
  </div>
</section>

<style nonce="@nonce">
  .lvl-badge { text-transform: uppercase; }
  .log-card { border-left: .25rem solid transparent; }
  .log-card[data-level="Critical"] { border-left-color: #dc3545; }
  .log-card[data-level="Error"] { border-left-color: #dc3545; }
  .log-card[data-level="Warning"] { border-left-color: #ffc107; }
  .log-card[data-level="Information"] { border-left-color: #0d6efd; }
  .log-card[data-level="Debug"] { border-left-color: #6c757d; }
  .log-card[data-level="Trace"] { border-left-color: #20c997; }
  .log-message { white-space: pre-wrap; word-break: break-word; }
  @@media (prefers-color-scheme: dark) {
    .card.shadow-sm { box-shadow: 0 .25rem .5rem rgba(255,255,255,.05) !important; }
    .table-striped>tbody>tr:nth-of-type(odd)>* { --bs-table-accent-bg: rgba(255,255,255,.015); }
  }
</style>

<!-- Provide i18n strings to the external script -->
<script nonce="@nonce" id="logs-i18n-json" type="application/json">{"Copy":"@SR["Copy"]","Copied":"@SR["Copied"]","Entries":"@SR["Entries"]"}</script>

<!-- Externalized ES module script to comply with CSP: no inline JS -->
<script type="module" src="~/js/logs-viewer.js" asp-append-version="true" defer></script>
